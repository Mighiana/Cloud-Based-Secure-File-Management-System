@{
    Layout = "_AdminLayout";
    ViewData["Title"] = "Reports";
}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="card shadow-sm secure-card-main">
                <div class="card-body">
                    <h2 class="card-title text-white" style="font-weight: bold;">Activity Reports</h2>
                    <p class="text-white">Generate and download reports for uploads, logs, and audits.</p>
                    <button id="refreshBtn" class="btn btn-outline-secondary mb-3" onclick="loadReportData()">Refresh Data</button>
                    <div class="row mt-4">
                        <div class="col-md-4">
                            <a href="/Admin/DownloadReport?type=uploads" class="btn btn-outline-primary btn-lg w-100 mb-2">
                                <i class="fas fa-upload me-2"></i>Upload Summary (CSV)
                            </a>
                        </div>
                        <div class="col-md-4">
                            <a href="/Admin/DownloadReport?type=logs" class="btn btn-outline-info btn-lg w-100 mb-2">
                                <i class="fas fa-scroll me-2"></i>CloudTrail Logs (CSV)
                            </a>
                        </div>
                        <div class="col-md-4">
                            <a href="/Admin/DownloadReport?type=audit" class="btn btn-outline-secondary btn-lg w-100 mb-2">
                                <i class="fas fa-shield-alt me-2"></i>Security Audit (CSV)
                            </a>
                        </div>
                    </div>

                    <!-- Storage Progress Bar Section (Real-Time via API) -->
                    <div class="row mt-4">
                        <div class="col-12">
                            <h5 class="text-white" style="font-weight: bold;">Storage Usage</h5>
                            <div class="progress" style="height: 20px;">
                                <div class="progress-bar bg-success" role="progressbar" id="storageProgressBar" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                            <small class="text-light" id="storageText">Usage: 0% of 1000MB limit</small>
                        </div>
                    </div>

                    <div class="mt-4">
                        <small class="text-light">Reports generated on-demand from S3 and CloudTrail.</small>
                    </div>
                    <a href="/Admin/Index" class="btn btn-outline-secondary mt-3">Back to Dashboard</a>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Load report data via API on page load
    document.addEventListener('DOMContentLoaded', loadReportData);

    async function loadReportData() {
        try {
            const response = await fetch('/Admin/GetReportData');
            const data = await response.json();
            // Update storage progress bar
            const progressBar = document.getElementById('storageProgressBar');
            const text = document.getElementById('storageText');
            if (progressBar && text) {
                const percent = data.storagePercent;
                progressBar.style.width = percent + '%';
                progressBar.setAttribute('aria-valuenow', percent);
                text.textContent = `Usage: ${percent}% of 1000MB limit (${data.storageFormatted})`;
            }
            // Add more updates for dynamic reports if needed
        } catch (error) {
            console.error('Error loading report data:', error);
            // Fallback static data
            document.getElementById('storageProgressBar').style.width = '20%';
            document.getElementById('storageText').textContent = 'Usage: 20% of 1000MB limit (200 MB)';
        }
    }
</script>